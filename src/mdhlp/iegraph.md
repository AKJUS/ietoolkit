# Title

__iegraph__ - Generates graphs based on regressions with treatment dummies common in impact evaluations.

For a more descriptive discussion on the intended usage and work flow of this command please see the [DIME Wiki](https://dimewiki.worldbank.org/Ietoolkit).

# Syntax

__iegraph__ , _varlist_ , [ __**basicti**tle__(_string_) __**varl**abels__ __save__(_string_) __**gray**scale__ __yzero__ __**barl**abel__ __**mlabc**olor__(_colorname_) __**mlabp**osition__(_clockpos_) __**mlabs**ize__(_size_) __barlabelformat__ __noconfbars__ __confbarsnone__(_varlist_) __confintval__(_numlist_) __norestore__ __**baropt**ions__(_string_) __ignoredummytest__ _twoway_scatter_options_ ]


| _options_ | Description |
|-----------|-------------|
| __**basicti**tle__(_string_) | Manually sets the title of the graph |
| __**varl**abels__ | Uses variable labels for legends instead of variable names |
| __save__(_string_) | Sets the filename and the directory to which the graph will be set/exported |
| __**gray**scale__ | Uses grayscales for the bars instead of colors |
| __yzero__ | Forces y-axis on the graph to start at 0 |
| __**barl**abel__ | Adds a label on top of the bars with their respective values |
| __**mlabc**olor__(_colorname_) | Manually set the colors of the bars |
| __**mlabp**osition__(_clockposstyle_) | Set color of bar label |
| __**mlabs**ize__(_size_) | Set position of bar label |
| __barlabelformat__ | Set font size of bar label |
| __noconfbars__ | Customizes format of bar label. Must be used with `barlabel` |
| __confbarsnone__(_varlist_) | Removes the confidence interval bars from graphs for all treatments |
| __confintval__(_numlist_) | Sets the confidence interval for the confidence interval bars. Default is .95 |
| __norestore__ | Allows you to debug your two way graph settings on the data set prepared by iegraph. To be used with `r(cmd)` |
| __**baropt**ions__(_string_) | Allows you to add formatting to the bars |
| __ignoredummytest__ | Ignores the tests that tests if the dummies fits one of the two models below |

Any _twoway graph scatter_ options that can be used with
regular _twoway graph scatter_ commands can also be used.
If any of these commands conflict with any of the built in options,
then the user specified settings have precedence.
See example 2 for details.

# Description

`iegraph` is a command creates bar graphs based on
coefficients of treatment dummies in regression results.
This command is developed for reading stored results from
two types of common impact evaluation regression models,
but there are countless of other examples where the command also can be used.
`iegraph` must be used immediately after running the regression
or after the regression result is restored using Stata's _ereturn results_.

## Model 1: OLS with Treatment Dummies
The most typical impact evaluation regression is to have the outcome variable
as the dependent variable and one dummy for each treatment arm
where control is the omitted category.
These regressions can also include covariates, fixed effects etc.,
but as long as the treatment status is defined by mutually exclusive dummy variables.
See especially examples 1 and 2 below.
This command works with any number of treatment arms
but works best from two arms (treatment and control)
to five treatment arms (4 different treatments and control).
More arms than that may result in a still correct but perhaps cluttered graph.

## Model 2: Difference-in-Differences
Another typical regression model in impact evaluations
are difference-in-difference (Diff-in-Diff)
models with two treatment arms (treatment and control) and two time periods.
If the Diff-in-Diff regression is specified as having the outcome variable
as the dependent variable and three dummy variables (time, treatment and time*treatment)
as the independent variables,
then this command will produce a nice graph.
Controls, treatment effects etc. may be added to the regression model.
See especially example 3.

## Graph Output
The graph generated by this command is created using the following values.
The control bar is the mean of the outcome variable for the control group.
It is not the constant from the regression as those are not identical if,
for example, fixed effects and covariates were used.
For each treatment group the bar is the sum of the value of the control bar
and the beta coefficient in the regression of the corresponding treatment dummy.
The confidence intervals are calculated from the variance in
the beta coefficients in the regression.

The graph also includes the N for each treatment arm in the regression
and uses that value as labels on the x-axis.
Stars are added to this value if the corresponding
coefficient is statistically different from zero in the regression

# Options

__**basicti**tle__(_string_) manually sets the title of the graph.
To apply formatting like title size, position, etc.,
use Stata's built in `title()` option instead.

 __**varl**abels__ sets the legends to the variable labels for the variables
 instead of the variable names.

 __save__(_string_) sets the legends to the variable labels
 for the variables instead of the variable names.

 __**gray**scale__ uses grayscale for the bars instead of colors.
 The color of the control bar will be black and the treatment bar will
 run in equal shade differences from light grey to dark grey.

 __yzero__ manually sets the y-axis of the graph to start at zero instead of the Stata default.
 In many cases, we expect that neither
 the default settings nor this option will make the axes look perfect,
 but you may use Stata's built in axis options
 that allow you to set the axes to perfectly fit your data.
 The command will ignore the `yzero` option in cases where the graph cannot
 be forced to zero i.e. where the values in the graph extend beyond zero,
 both positively or negatively.
 A warning will be displayed telling the user that the option has been ignored.
 Despite the warning, the graph will be produced correctly.

 __**barl**abel__ adds a label on top of the bars with their respective values.
 Equivalent to specifying option `blabel(bar)` in a _bar graph_ (see `help graph_bar`).

 __**mlabc**olor__(_colorname_) sets color of bar label.
 May only be used with the `barlabel` option.
 See `help colorname` for valid values.

 __**mlabp**osition__(_clockpos_) sets position of bar label.
 May only be used with the `barlabel` option.
 See `help clockposstyle` for valid values.

 __**mlabs**ize__(_size_) sets size of bar label.
 May only be used with the `barlabel` option.
 See `help textsizestyle` for valid values.

 __barlabelformat__ customizes `barlabel` format.
 May only be used with the `barlabel` option.
 Options allowed have the formats _%#.#f_ or _%#.#e_.
 Default if _%9.1f_. See `help format` for valid formats.

 __noconfbars__ removes the confidence interval bars from graphs for all treatments.
 The default value for the confidence interval bars is 95%.

 __confbarsnone__(_varlist_) removes confidence interval bars
 from only the _varlist_ listed.
 The remaining variables in the graphs which have not been specified
 in option `confbarsnone` will still have the confidence interval bars.

 __confintval__(_numlist_) sets the confidence interval for the confidence interval bars.
 Default is .95. Values between 0 and 1 are allowed.

 __norestore__ returns the data set that `iegraph` prepares to create the graph.
 This is helpful when de-bugging how one of Stata's many graph options
 can be applied to an `iegraph` graph.
 This option is meant to be used in combination with
 the returned result in `r(cmd)`.
 `r(cmd)` gives you the line of code `iegraph` prepares to create the graph
 and `norestore` gives you access to the data that code is meant to be used on.
 This approach will help you de-bug how to apply
 Stata's built in graph options to an `iegraph` graph.
 Note that this option deletes any unsaved changes made to your data in memory.

 __**baropt**ions__(_string_) allows you to add formatting options
 that are applied to each bar and not the graph itself.
 Example of such option are _twoway_bar_ options and _axis_options_ options.
 It is not possible to use this option to add formatting to individual bars.
 Everything added in this option is added to all bars.
 Formatting added in this option takes precedence over
 any default formatting or formatting set in any other option.

 __ignoredummytest__ ignores the tests that test if the dummies
 fits one of the two models this command is intended for.
 The two models are described in detail above.
 There might be models we have not thought of for which this command is helpful as well.
 Use this option to lift the restrictions of those two models.
 But be careful, this command has not been tested for other models than the two described.

# Stored results
<!-- Document all results this command returns as either r-class, e-class or s-class macros -->

# Examples

## Example 1

```
regress outcomevar treatment_dummy
iegraph treatment_dummy , basictitle("Treatment Effect on Outcome")
```

In the example above, there are only two treatment arms (treatment and control).
_treatment_dummy_ has a 1 for all treatment observations and a 0 for all control observations.
The graph will have one bar for control and it shows
the mean for _outcomevar_ for all observations in control.
The second bar in the graph will be the sum of that mean
and the coefficient for _treatment_dummy_ in the regression.
The graph will also have the title: _Treatment Effect on Outcome_.

## Example 2

```
regress income tmt_1 tmt_2 age education, cluster(district)
iegraph tmt_1 tmt_2, noconfbars yzero basictitle("Treatment effect on income")
```

In the example above, the treatment effect on income in researched.
There are three treatment arms; control, treatment 1 (_tmt_1_) and treatment 2 (_tmt_2_).
It is important that no observation has the value 1 in both _tmt_1_ and _tmt_2_
(i.e. no observation is in more than one treatment)
and some observations must have the value 0 in both _tmt_1_ and _tmt_2_
(i.e. control observations).
The variables age and education are covariates (control variables)
and are not included in `iegraph`.
The option `noconfbars` omits the confidence interval bars,
and `yzero` sets the y-axis to start at 0.

## Example 3

```
regress chld_wght time treat timeXtreat
iegraph time treat timeXtreat , basictitle("Treatment effect on Child Weight (Diff-in-Diff)")
```

In the example above, the data set is a panel data set
with two time periods and the regression estimates the treatment effect
on child weight using a _Difference-in-Differences_ model.
The dummy variable time indicates if it is time period 0 or 1.
The dummy variable treat indicates if the observation is treatment or control.
_timeXtreat_ is the interaction term of time and treat.
This the standard way to set up a _Difference-in-Differences_ regression model.

## Example 4

```
regress harvest T1 T2 T3
iegraph T1 T2 T3 , basictitle("Treatment effect on harvest") xlabel(,angle(45)) yzero ylabel(minmax) save("Graph1.gph")}
```

The example above shows how to save a graph to disk.
It also shows that most two-way graph options can be used.
In this example,
the `iegraph` option `yzero` conflicts with the two-way option `ylabel(minmax)`.
In such a case the user specified option takes precedence over `iegraph` options like `yzero`.

# Feedback, bug reports and contributions

Please send bug-reports, suggestions and requests for clarifications
writing "ietoolkit iegraph" in the subject line to: dimeanalytics@worldbank.org

You can also see the code, make comments to the code, see the version
history of the code, and submit additions or edits to the code through [GitHub repository](https://github.com/worldbank/ietoolkit) for `ietoolkit`.

# Author

All commands in `ietoolkit` are developed by DIME Analytics at DIME, The World Bank's department for Development Impact Evaluations.

Main authors: Kristoffer Bjarkefur, Luiza Cardoso De Andrade, DIME Analytics, The World Bank Group
